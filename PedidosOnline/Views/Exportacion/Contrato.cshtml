@model PedidosOnline.Models.Contrato
@{
    ViewBag.Title = "Contrato";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    a {
        color: #333;
    }
    input {
        width:100%
    }
    select {
        width:100%
    }
</style>

<link href="~/Content/Tabs.css" rel="stylesheet" />
<script type="text/javascript">
    function guardarContrato(a)
    {
        //debugger
        ModalProcesandoShow();
        var RowID = $(".RowID").val();
        var RowIDPro = $(".RowIDPro").val();

        //if(RowIDPro == ""){
        //    Mensajes('El campo proforma es requerido!', 'error', '');
        //    ModalProcesandoHiden();
        //    return null;
        //}
        //if($(".autoc_inspector").val()== ""){
        //    Mensajes('El campo inspector es requerido!', 'error', '');
        //    ModalProcesandoHiden();
        //    return null;
        //}
        //if($("#fecha").val()== ""){
        //    Mensajes('El campo fecha es requerido!', 'error', '');
        //    ModalProcesandoHiden();
        //    return null;
        //}
        //if($("#periodoE").val()== ""){
        //    Mensajes('El campo periodo embarque es requerido!', 'error', '');
        //    ModalProcesandoHiden();
        //    return null;
        //}
        //if($("#transporte").val()== ""){
        //    Mensajes('El campo transporte es requerido!', 'error', '');
        //    ModalProcesandoHiden();
        //    return null;
        //}
        var termino=$("#terminos").text();
        console.log(termino)
        var formData = new FormData(document.getElementById("form"));
        formData.append('RowID',RowID,'RowIDPro',RowIDPro,'terminos',termino)
        $.ajax({
            type: "post",
            dataType: "html",
            data: formData,
            cache: false,
            contentType: false,
            processData: false,
            url: "RegistrarContrato"
            //dataType: "html",
            //data: formData
                //formulario: $("#form").serialize(),
                //RowID: RowID,
                //RowIDPro: RowIDPro
            ,
            success: function (data2) {
                if(a == 1){
                    if (@Model.RowID >0) {
                        Mensajes('Guardado Satisfactoriamente','success','');
                    }
                    else
                    {
                        location.href="../Exportacion/Contrato?rowid="+data2;
                    }
                    ModalProcesandoHiden();
                }
                else
                {
                    location.href="../Exportacion/Contratos";
                }
            },
            error: function (request) {
                Mensajes(request.responseText, 'error', '');
                ModalProcesandoHiden();
            }
        });
    }

    function cargarItemsContrato(rowid_contrato) {
        $.ajax({
            type: "GET",
            url: "/Exportacion/ItemsContrato",
            data: {
                RowID: rowid_contrato
            },
            success: function (data) {
                $('#tblProductos tbody').empty();
                $('#tblProductos tbody').append(data);
            },
            error: function (request) {
                Mensajes("Se presento un error", 'error', '');

            }
        });
    }
    function siguiente()
    {
        location.href='../Exportacion/OrdenCompra?rowid_contrato='+@Model.RowID;
    }


</script>

<div class="panel">
    <div class="row">
        <div class="row" id="div_menu" style="margin-bottom:20px">
            <div class="col-md-12">
                <div class="nav">
                    <span>
                        &nbsp;&nbsp;
                        <a href="@Url.Action("Contratos","Exportacion",new {  @rih = Request.Params["rih"] })" class="alink">
                            <i class="glyphicon glyphicon-list-alt"></i>&nbsp;<span class="lang" key="VISTA">Vista&nbsp;&nbsp;</span>
                        </a>
                    </span>
                    <span>
                        <a href="javascript:guardarContrato(1);" class="alink">
                            <i class="glyphicon glyphicon-floppy-disk"></i>&nbsp;<span class="lang" key="GUARDAR">Guardar</span>
                        </a>
                    </span>
                    <span>
                        &nbsp;&nbsp;
                        <a href="javascript:guardarContrato(2);" class="alink">
                            <i class="glyphicon glyphicon-floppy-disk"></i><span class="lang" key="GUARDAR_&_CERRAR">&nbsp;Guardar&nbsp;&&nbsp;Cerrar</span>
                        </a>
                    </span>

                    @if (Model.RowID != 0)
                    {
                        <span>
                            &nbsp;&nbsp;
                            <a href="javascript:siguiente()" class="alink">
                                <i class="glyphicon glyphicon-arrow-right"></i><span class="lang" key="Siguiente">Siguiente</span>
                            </a>
                        </span>
                    }
                </div>
            </div>
        </div>
        <div class="tabbable tabbable-custom tabs-top">
            <ul class="nav nav-tabs tabs-top">
                <li id="li_tab1" class="active"><a href="#tab1" data-toggle="tab">Datos generales</a></li>
                <li id="li_tab2"><a href="#tab2" data-toggle="tab">Items</a></li>
                @*<li class="active" id="li_tab1"><a href="#tab_1" id="litab_1" data-toggle="tab" class="lang" key="">Datos generales</a></li>*@
                @*<li class="item" id="li_tab2"><a href="#tab_2" id="litab_2" data-toggle="tab" class="lang" key="">Items </a></li>*@
            </ul>
        </div>
        <div class="tab-content" style="overflow:hidden">
            <div class="col-md-12">
                <form id="form" name="form" onsubmit="return false">
                    <input type="hidden" class="RowID" id="RowID" name="RowID" value="@Model.RowID" />
                    <input type="hidden" class="RowIDPro" name="RowIDPro" />
                    <input type="hidden" class="RowIDCalculadora" name="RowIDCalculadora" value="@Model.CalculadoraID" />
                    <div class="col-md-5">
                        <div class="form-group">
                            <div class="col-md-3">
                                <label for="Auto_Calculadora" class="lang">Comprador/Calculadora</label>
                            </div>
                            <div class="col-md-5">
                                @if (Model.RowID > 0)
                                {
                                    <input type="text" id="Auto_Calculadora" name="Auto_Calculadora" value="@Model.Calculadora.Tercero.Identificacion - @Model.Calculadora.Tercero.RazonSocial  @Model.Calculadora.Opcion.Nombre " placeholder="---" />
                                    <input type="hidden" id="ClienteID" name="ClienteID"  value="@Model.CalculadoraID" required />
                                }
                                else
                                {
                                    <input type="text" id="Auto_Calculadora" name="Auto_Calculadora" value="@Model.CalculadoraID" placeholder="---" />
                                    <input type="hidden" id="ClienteID" name="ClienteID" required />
                                }
                                
                            </div>
                        </div>
                        <br />
                        <div class="form-group">
                            <div class="col-md-3">
                                <label for="intermediario" class="lang" key="INTERMEDIARIO">Intermediario</label>
                            </div>
                            <div class="col-md-5">
                                <input type="text" id="intermediario" name="" class="autocompletar" value="@Model.Tercero1.RazonSocial" placeholder="---" style="width: 100%" autocomplete="off" autofocus required />
                                <input type="hidden" id="valintermediario" name="valintermediario" value="@Model.IntermediarioID"required />
                            </div>
                        </div>
                        <br />

                       
                        <div class="form-group">
                            <div class="col-md-3">
                                <label for="fecha" class="lang">Fecha</label>
                            </div>
                            <div class="col-md-5">
                                <input type="text" id="fecha" name="fecha" style="width: 100%" value="@Model.Fecha" readonly="readonly" />
                            </div>
                        </div>
                        <br />
                        @*<div class="form-group">
                            <div class="col-md-3">
                                <label for="intermediario" class="lang">Intermediario</label>
                            </div>
                            <div class="col-md-5">
                                <input type="text" id="intermediario" name="" class="autocompletar" placeholder="---"  value="@Model.IntermediarioID" style="width: 100%" />
                            </div>
                        </div>
                        <br />*@
                        @*<div class="form-group">
                                <div class="col-md-3">
                                    <label for="fecha" class="lang">Fecha</label>
                                </div>
                                <div class="col-md-4">
                                    <input type="text" id="fecha" name="fecha" style="width: 100%"/>
                                </div>
                            </div>
                            <br />*@
                        <div class="form-group">
                            <div class="col-md-3">
                                <label for="periodoE" class="lang">Per. embarque</label>
                            </div>
                            <div class="col-md-5">
                                <input type="text" name="periodoE" id="periodoE" value="@Model.Periodo" style="width: 100%" required/>
                            </div>
                        </div>
                        <br />
                        <div class="form-group">
                            <div class="col-md-3">
                                <label for="TerminosCondiciones" class="lang">Terminos y condiciones</label>
                            </div>
                            <div class="col-md-5" id="modal-terminos">
                                <a class="ui-button-text-icon-primary"  onclick="cargarmodal()">Ver terminos</a>
                               @*<input type="hidden" name="terminos" id="terminoseviar" />*@
                            </div>
                        </div>
                        <br />
                        <br />
                        <div class="form-group">
                            <div class="col-md-3">
                                <label for="autoc_inspector" class="lang">Inspector</label>
                            </div>
                            <div class="col-md-5">
                                <input type="text" id="autoc_inspector" name="autoc_inspector" class="autocompletar" value="@Model.Tercero2.RazonSocial" placeholder="---" style="width: 100%" />
                                <input type="hidden" id="valautoc_inspector" name="valautoc_inspector" class="" value="@Model.InspectorID" placeholder="---" style="width: 100%" />
                            </div>


                        </div>
                        <br />
                        <div class="form-group">
                            <div class="col-md-3">
                                <label for="calidad" class="lang">Seguro</label>
                            </div>
                            <div class="col-md-5">
                                @if (Model.RowID > 0)
                                {
                                    if (Model.Seguro == true)
                                    {
                                        <div class="col-md-4">
                                            <strong>
                                                SI
                                            </strong>
                                            <input type="radio" class="col-md-6" style="position:absolute" name="seguro" value="true" checked />
                                        </div>
                                        <div class="col-md-4">
                                            <strong>
                                                NO
                                            </strong>
                                            <input type="radio" class="col-md-6" style="position:absolute" name="seguro" value="false" />
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="col-md-4">
                                            <strong>
                                                SI
                                            </strong>
                                            <input type="radio" class="col-md-6" style="position:absolute" name="seguro" value="true"  />
                                        </div>
                                        <div class="col-md-4">
                                            <strong>
                                                NO
                                            </strong>
                                            <input type="radio" class="col-md-6" style="position:absolute" name="seguro" value="false" checked />
                                        </div>
                                    }

                                }
                                else
                                {
                                    <div class="col-md-4">
                                        <strong>
                                            SI
                                        </strong>
                                        <input type="radio" class="col-md-6" style="position:absolute" name="seguro" value="true" checked />
                                    </div>
                                        <div class="col-md-4">
                                            <strong>
                                                NO
                                            </strong>
                                            <input type="radio" class="col-md-6" style="position:absolute" name="seguro" value="false"/>
                                        </div>
                                }

                            </div>
                        </div>
                        
                        <br />
                        <div class="form-group">
                            <div class="col-md-3">
                                <label for="embarqueP" class="lang">Embarque parcial</label>
                            </div>
                            <div class="col-md-5">
                                @if (Model.RowID > 0)
                                {
                                    if (Model.EmbarqueParcial == true)
                                    {
                                        <div class="col-md-4">
                                            <strong>
                                                SI
                                            </strong>
                                            <input type="radio" class="col-md-6" style="position:absolute" name="embarqueP" value="true" checked />
                                        </div>
                                        <div class="col-md-4">
                                            <strong>
                                                NO
                                            </strong>
                                            <input type="radio" class="col-md-6" style="position:absolute" name="embarqueP" value="false" />
                                        </div>
                                    }
                                    if (Model.EmbarqueParcial == false)
                                    {
                                        <div class="col-md-4">
                                            <strong>
                                                SI
                                            </strong>
                                            <input type="radio" class="col-md-6" style="position:absolute" name="embarqueP" value="true"  />
                                        </div>
                                        <div class="col-md-4">
                                            <strong>
                                                NO
                                            </strong>
                                            <input type="radio" class="col-md-6" style="position:absolute" name="embarqueP" value="false" checked />
                                        </div>
                                    }
                                }
                                else
                                {
                                <div class="col-md-4">
                                    <strong>
                                        SI
                                    </strong>
                                    <input type="radio" class="col-md-6" style="position:absolute" name="embarqueP" value="true" checked />
                                </div>
                                <div class="col-md-4">
                                    <strong>
                                        NO
                                    </strong>
                                    <input type="radio" class="col-md-6" style="position:absolute" name="embarqueP" value="false" />
                                </div>
                                }
                               
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <div class="col-md-3">
                                <label for="consecutivo" class="lang">Consecutivo</label>
                            </div>
                            <div class="col-md-5">
                                <input type="text" id="consecutivo" name="consecutivo" value="@Model.Consecutivo" style="width: 100%" />
                            </div>
                        </div>
                        <br />
                        <div class="form-group">
                            <div class="col-md-3">
                                <label for="vendedor" class="lang">Vendedor</label>
                            </div>
                            <div class="col-md-4">
                                <input type="text" id="vendedor" name="vendedor" value="@Model.Tercero3.NombreComercial" placeholder="---" />
                                <input type="hidden" id="valvendedor" name="valvendedor" value="@Model.Tercero3.RowID" placeholder="---" />
                            </div>
                        </div>
                        <br />
                        <div class="form-group">
                            <div class="col-md-3">
                                <label for="formaP" class="lang">Forma de pago</label>
                            </div>
                            <div class="col-md-4">
                                <select id="formaP" name="formaP" placeholder="Elija una opción">
                                    @foreach (var formapago in ViewBag.FormasPago)
                                    {
                                        if (Model.RowID > 0)
                                        {
                                            if (Model.Opcion1.RowID == formapago.RowID)
                                            {
                                                <option value="@formapago.RowID" selected>@formapago.Nombre</option>
                                            }
                                            else 
                                            {
                                                <option value="@formapago.RowID">@formapago.Nombre</option>
                                            }
                                        }
                                        else
                                        {
                                            <option value="@formapago.RowID">@formapago.Nombre</option>
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                        <br />
                        <div class="form-group">
                            <div class="col-md-3">
                                <label for="origen" class="lang">Termino Incoterm</label>
                            </div>
                            <div class="col-md-4">
                                @if (Model.RowID>0)
                                {
                                    <input type="text" id="Incoterm" name="Incoterm" value="@Model.Calculadora.Opcion.Nombre" placeholder="@Model.Calculadora.Opcion.Nombre" disabled />
                                }
                                else
                                {
                                    <input type="text" id="Incoterm" name="Incoterm" disabled />
                                }

                            </div>
                        </div>
                        <br />
                        <div class="form-group">
                            <div class="col-md-3">
                                <label for="empaque" class="lang">Transporte corresponde</label>
                            </div>
                            <div class="col-md-4">
                                @if (Model.RowID > 0)
                                {
                                    <input type="text" id="tranportecorresponde" name="tranportecorresponde" placeholder="@Model.Calculadora.Opcion.Codigo" readonly />
                                }
                                else
                                {
                                    <input type="text" id="tranportecorresponde" name="tranportecorresponde" placeholder="---" readonly />
                                }

                            </div>
                        </div>
                        <br />
                        <br />
                        <div class="form-group">
                            <div class="col-md-3">
                                <label for="formaP" class="lang">Calidad 1</label>
                            </div>
                            <div class="col-md-4">
                                <input type="text" id="calidad1" name="calidad1" value="@Model.Calidad1" />
                            </div>
                        </div>
                        <br />
                        <div class="form-group">
                            <div class="col-md-3">
                                <label for="formaP" class="lang">Calidad 2 </label>
                            </div>
                            <div class="col-md-4">
                                <input type="text" id="calidad2" name="calidad2" value="@Model.Calidad2" />
                            </div>
                        </div>
                        <br />

                        @*<div class="form-group">
                                <label for="producto" class="lang">Producto</label>
                                <input type="text" id="producto" name="producto" placeholder="---" disabled />
                            </div>
                            <div class="form-group">
                                <label for="producto" class="lang">Cantidad</label>
                                <input type="text" id="cantidad" name="cantidad" placeholder="---" disabled />
                            </div>
                            <div class="form-group">
                                <label for="precio" class="lang">Precio</label>
                                <input type="text" id="precio" name="precio" placeholder="---" disabled />
                            </div>

                            <div class="form-group">
                                <label for="empaque" class="lang">Empaque</label>
                                <input type="text" id="empaque" name="empaque" placeholder="---" disabled />
                            </div>
                            <div class="form-group">
                                <label for="empaque" class="lang">Peso</label>
                                <input type="text" id="peso" name="peso" placeholder="---" disabled />
                            </div>*@
                    </div>
                    <div class="modal fade col-md-12" id="myModal1" data-backdrop="static" data-keyboard="false" style="overflow: auto;">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                   
                                    <h4 class="modal-title"><b>Terminos Condiciones</b></h4>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            @if (Model.TerminosCondiciones != null)
                                            {
                                                <textarea id="terminos" name="terminos">@Model.TerminosCondiciones</textarea>
                                            }
                                            else
                                            {
                                                <textarea id="terminos" name="terminos">@ViewBag.Termino.Body</textarea>
                                            }
                                            

                                        </div>
                                    </div>
                                </div>
                            <div class="modal-footer">
                                <button type="button" class="salir" aria-hidden="true">Verficado</button>
                            </div>
                            </div><!-- /.modal-content -->
                        </div><!-- /.modal-dialog -->
                    </div><!-- /.modal -->
                </form>
            </div>
        </div>
        <div id="tab_2" class="tab-pane">
            <div class="col-md-12" style="margin-top:10px;">
                <table id="tblProductos" class="table table-condensed table-striped table-bordered table-hover table-checkable table-responsive">
                    <thead>
                        <tr>
                            <th>Ref.</th>
                            <th>Descripcion</th>
                            <th>Cantidad</th>
                            <th>Precio</th>
                            <th>Und. empaque</th>
                            <th>Peso</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</div>


<script>
    $(document).ready(function(){
        $("#terminos").summernote({
            height : '100%'
        });
        $(".salir").click(function(){
            $("#myModal1").modal('hide');
        })
        cargarItemsContrato($(".RowIDCalculadora").val());
    })
    function cargarmodal(){
        $("#myModal1").modal('show');
    }
    $('#fecha').datepicker({
        dateFormat: 'dd/mm/yy',
        minDate: 0,
        maxDate: '+3Y',
        inline: true
    });
    $('#periodoE').datepicker({
        dateFormat: 'dd/mm/yy',
        minDate: 0,
        maxDate: '+3Y',
        inline: true
    });
    
    $('.autocompletar').on('keyup keypress', function (e) {
        //debugger
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) { //Enter keycode
            return false;
        }
    });

    $(".autocompletar").autocomplete({
        source: "Buscar_Tercero",
        minLenght: 3,
        select: function (evento, ui) {//seleccion al autocompletar
            //debugger
            if (ui.item != null) {//si hay valor en la seleccion autocompletar
                $(this).val(ui.item.label);
                $("#val"+$(this).attr("id")).val(ui.item.RowID)
            }
        },
        change: function (event, ui) {

        }
    });
    $("#vendedor").autocomplete({
        source: "Buscar_Empresa",
        minLenght: 3,
        select: function (evento, ui) {//seleccion al autocompletar
            //debugger
            if (ui.item != null) {//si hay valor en la seleccion autocompletar
                $(this).val(ui.item.label);
                $("#val"+$(this).attr("id")).val(ui.item.RowID)
            }
        },
        change: function (event, ui) {

        }
    });

    $('#Auto_Contrato').on('keyup keypress', function (e) {
        //debugger
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code == 13) { //Enter keycode
            return false;
        }
    });




    $("#Auto_Calculadora").autocomplete({
        source: "Buscar_Calculadora",
        minLenght: 3,
        select: function (evento, ui) {//seleccion al autocompletar
            console.log(ui);
            if (ui.item != null) {//si hay valor en la seleccion autocompletar
                $("#Auto_Calculadora").val(ui.item.RowID+"-"+ui.item.label);
                $("#ClienteID").val(ui.item.RowIDCliente);
                $("#Incoterm").val(ui.item.incoterm);
                $("#tranportecorresponde").val(ui.item.tranportecorresponde);
                //$("#destino").val(ui.item.destino);
                //$("#formaP").val(ui.item.formaPago);
                $(".RowIDCalculadora").val(ui.item.RowID);
                cargarItemsContrato(ui.item.RowID);
            }
        },
        change: function (event, ui) {

        }
    });
    $("#li_tab1").click(function () {
        //debugger
        $("#tblProductos").hide();
        $("#form").show();

    });

    $("#li_tab2").click(function () {
        //debugger
        $("#tblProductos").show();
        $("#form").hide();
    });


    @*$(document).ready(function () {
        $("#tblProductos").hide();
        //debugger
        if (@Model.RowID > 0)
        {
            var titulo = $("#autoc_proforma").val();
            $.ajax({
                type: "GET",
                url: "Datos_Proforma",
                data:
                      {
                          titulo: titulo
                      },
                success: function (data) {
                    $("#vendedor").val(data.vendedor);
                    $("#comprador").val(data.comprador);
                    $("#origen").val(data.origen);
                    $("#destino").val(data.destino);
                    $("#formaP").val(data.formaPago);
                    $(".RowIDPro").val(data.RowID);
                    cargarItemsContrato(data.RowID);
                },
                error: function (request) {
                    Mensajes("Se presento un error", 'error', '');

                }
            });
        }
    });*@

</script>
