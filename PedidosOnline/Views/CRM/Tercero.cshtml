@model PedidosOnline.Utilidades.TerceroCompletInfo

@{
    ViewBag.Title = "Tercero";
}
<link href="~/Content/js/select2/select2.css" rel="stylesheet" />
<script type="text/javascript" src="~/Content/js/select2/select2.min.js?v=166"></script> <!-- Styled select boxes -->

<script src="~/Content/js/HighChart/highcharts.js"></script>
<script src="~/Content/js/HighChart/modules/exporting.js"></script>
<style>
    .highcharts-legend {
        display: none;
    }
    .row {
        margin:4px
    }
    input {
        width:100%
    }
</style>
<div class="row">
    <div class="row" id="div_menu" style="margin-bottom:20px">
        <div class="col-md-12">
            <div class="nav">
                @*<span>
                        &nbsp;&nbsp;
                        <a href="javascript:enviarformulario(1);" class="alink">
                            <i class="glyphicon glyphicon-floppy-disk"></i>&nbsp;Guardar
                        </a>
                    </span>
                    <span>
                        &nbsp;&nbsp;
                        <a href="javascript:enviarformulario(2);" class="alink">
                            <i class="glyphicon glyphicon-floppy-disk"></i>&nbsp;Guardar&nbsp;&&nbsp;Cerrar
                        </a>
                    </span>*@
                <span>
                    &nbsp;&nbsp;
                    <a href="@Url.Action("ListadoTercerosSucursal","CRM",new {  @rih = Request.Params["rih"] })" class="alink">
                        <i class="glyphicon glyphicon-list-alt"></i>&nbsp;<span class="lang" key="VISTA">Vista</span>
                    </a>
                </span>
            </div>
        </div>
    </div>
    <div class="tabbable tabbable-custom tabs-top">
        <ul class="nav nav-tabs tabs-top">
            <li class="active"><a href="#tab_1" id="litab_1" data-toggle="tab" class="lang" key="">Tercero</a></li>
            <li><a href="#tab_2" id="litab_2" data-toggle="tab" lang" key="AREA_RESPONSABLE">Sucursales</a></li>
            @*<li><a href="#tab_3" id="litab_4" data-toggle="tab" key="INDEMNIZACION">Puntos Envio</a></li>*@
            <li><a href="#tab_4" id="litab_4" data-toggle="tab" key="INDEMNIZACION">Contactos</a></li>
            <li><a href="#tab_5" id="litab_3" data-toggle="tab" key="SEGUIMIENTO_PQRS">Actividades</a></li>
        </ul>
    </div>
    <!--INFORMACIÓN TERCERO-->
    <div class="tab-content" style="overflow:hidden">
        <div class="tab-pane active" id="tab_1">
            <div class="col-md-4">
                <div class="col-md-12">

                    <form id="form" name="form">
                        <div style="margin-bottom: 20px;">
                            <br />
                            <h4 class="lang" key="INFORMACION_TERCERO">Información Tercero</h4>
                            <hr />
                        </div>
                        <div style="margin-left:10px">
                            <div class="row">
                                <div class="col-md-4"><label class="lang" for="razonsocial" key="RAZON_SOCIAL">Razon Social</label></div>
                                <div class="col-md-8"><input type="text" value="@Model.tercero.RazonSocial" disabled="disabled" /></div>
                            </div>
                            <div class="row">
                                <div class="col-md-4"><label class="lang" for="nombre_comercial" key="NOMBRE_COMERCIAL">Nombre Comercial</label></div>
                                <div class="col-md-8"><input type="text" value="@Model.tercero.NombreComercial" disabled="disabled" /></div>
                            </div>
                            <div class="row">
                                <div class="col-md-4"><label class="lang" for="codERP" key="NOMBRE_COMERCIAL">Codigo ERP</label></div>
                                <div class="col-md-8"><input type="text" value="@Model.tercero.RowIDERP" disabled="disabled" /></div>
                            </div>
                            <div class="row">
                                <div class="col-md-4"><label class="lang" for="tipo_identificacion" key="TIPO_DOCUMENTO">Tipo Documento</label></div>
                                <div class="col-md-8">
                                    @if (Model.tercero.TipoIdentificacion == "N")
                                    {
                                        <input type="text" value="Nit" disabled="disabled" />
                                    }
                                    else
                                    {
                                        <input type="text" value="Cedula" disabled="disabled" />
                                    }
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4"><label class="lang" for="identificacion" key="IDENTIFICACION">Identificación</label></div>
                                <div class="col-md-8"><input type="text" value="@Model.tercero.Identificacion" disabled="disabled" /></div>
                            </div>
                            
                            <br />
                        </div>
                        <!--INFORMACI'ON CONTACTO PRINCIPAL-->
                        <div style="margin-bottom: 20px;">
                            <h4 class="lang" key="INFORMACION_CONTACTO">Información Contacto</h4>
                            <hr style="margin:0px">
                        </div>
                        <div style="margin-left:10px">
                            <div class="row">
                                <div class="col-md-4"><label class="lang" key="NOMBRE">Nombre</label></div>
                                <div class="col-md-8"><input type="text" id="contacto_nombre" value="@Model.contacto_principal.Nombre @Model.contacto_principal.Apellido" disabled="disabled" /></div>
                            </div>
                            <div class="row">
                                <div class="col-md-4"><label class="lang" key="TELEFONO_PRINCIPAL">Teléfono Principal</label></div>
                                <div class="col-md-8"><input type="text" id="contacto_telefono" value="@Model.contacto_principal.Telefono1" disabled="disabled" /></div>
                            </div>
                            <div class="row">
                                <div class="col-md-4"><label class="lang" key="TELEFONO_ALTERNO">Teléfono Alterno</label></div>
                                <div class="col-md-8"><input type="text" id="contacto_telefono2" value="@Model.contacto_principal.Telefono2" disabled="disabled" /></div>
                            </div>
                            <div class="row">
                                <div class="col-md-4"><label class="lang" key="DIRECCION_PRINCIPAL">Dirección Principal</label></div>
                                <div class="col-md-8"><input type="text" id="sucursal_principal" value="@Model.contacto_principal.Direccion1" disabled="disabled" /></div>
                            </div>
                            <div class="row">
                                <div class="col-md-4"><label class="lang" key="CIUDAD">Ciudad</label></div>
                                @if (@Model.contacto_principal.Ciudad != null)
                                {
                                    <div class="col-md-8"><input type="text" id="sucursal_ciudad" value="@Model.contacto_principal.Ciudad.Nombre" disabled="disabled" /></div>
                                }
                                else
                                {
                                    <div class="col-md-8"><input type="text" id="sucursal_ciudad" value="" disabled="disabled" /></div>
                                }
                            </div>
                            <div class="row">
                                <div class="col-md-4"><label class="lang" key="DEPARTAMENTO">Departamento</label></div>
                                @if (@Model.contacto_principal.Ciudad != null)
                                {
                                    <div class="col-md-8"><input type="text" id="sucursal_departamento" value="@Model.contacto_principal.Ciudad.Departamento.Nombre" disabled="disabled" /></div>
                                }
                                else
                                {
                                    <div class="col-md-8"><input type="text" id="sucursal_departamento" value="" disabled="disabled" /></div>
                                }
                            </div>
                            <div class="row">
                                <div class="col-md-4"><label class="lang" key="PAIS">País</label></div>
                                @if (@Model.contacto_principal.Ciudad != null)
                                {
                                    <div class="col-md-8"><input type="text" id="sucursal_pais" value="@Model.contacto_principal.Ciudad.Departamento.Pais.Nombre" disabled="disabled" /></div>
                                }
                                else
                                {
                                    <div class="col-md-8"><input type="text" id="sucursal_pais" value="" disabled="disabled" /></div>
                                }
                            </div>
                        </div>

                        <br />
                        <!--INFORMACION CLASIFICACION-->
                        @*<div style="margin-bottom: 20px;">
                            <h4 class="lang" key="CLASIFICACION">Clasificación</h4>
                            <hr style="margin:0px">
                        </div>
                        <div style="margin-left:10px">
                            <div class="form-group">
                                <label>Tipo de Relación</label>
                                @if (Model.tercero.Cliente == 1)
                                {
                                    <input type="checkbox" checked disabled="disabled" /><label style="width:auto;">Cliente</label>
                                }
                                else
                                {
                                    <input type="checkbox" disabled="disabled" /><label style="width:auto;">Cliente</label>
                                }
                                &nbsp;&nbsp;
                                @if (Model.tercero.Proveedor == 1)
                                {
                                    <input type="checkbox" disabled="disabled" checked /><label style="width:auto;">Proveedor</label>
                                }
                                else
                                {
                                    <input type="checkbox" disabled="disabled" /><label style="width:auto;">Proveedor</label>
                                }
                                &nbsp;&nbsp;
                                @if (Model.tercero.Accionista == 1)
                                {
                                    <input type="checkbox" disabled="disabled" checked /><label style="width:auto;">Socio</label>
                                }
                                else
                                {
                                    <input type="checkbox" disabled="disabled" /><label style="width:auto;">Socio</label>
                                }

                            </div>
                        </div>*@
                    </form>
                </div>
            </div>
            <div class="col-md-8">
                <br />
                <h4 class="lang" key="INFORMACION_TERCERO">Información de Pedidos</h4>
                <hr />
                @*<h3 style="font-weight:normal; font-family: 'Segoe UI' , sans-serif;">Hist&oacute;rico de Pedidos</h3>*@
                <div class="row">
                    <div class="col-md-6">
                        <div id="chart_mensual" style="height:250px" @*style="height:270px;width:480px"*@></div>
                    </div>
                    <div class="col-md-6">
                        <div id="chart_anual" style="height:250px" @*style="height:270px;width:480px"*@></div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div id="chart_anual_cartera" style="height:250px;" @*style="height:270px;width:960px"*@></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="tab-pane" id="tab_2">
            <div class="row">
                <div class="col-md-12">
                    <br />
                    <h4 class="lang" key="SUCURSALES">Sucursales</h4>
                    <hr />
                </div>
                <div class="col-md-12" style="margin-top:4px">

                    <table id="TableSucursal" class="table table-condensed table-striped table-bordered table-hover table-checkable table-responsive datatable">
                        <thead>
                            <tr>
                                <th> </th>
                                <th class="lang" key="SUCURSAL">Sucursal</th>
                                <th class="lang" key="DIRECCION">Centro Operaciones</th>
                                <th class="lang" key="DIRECCION">Bloqueo de Cupo</th>
                                <th class="lang" key="TELEFONO">Bloqueo de Mora</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var sucursal in ((List<PedidosOnline.Models.Sucursal>)ViewBag.ListadoSucursales))
                            {
                                <tr>
                                    <td>

                                        @if (sucursal.Tercero.RowID == Model.tercero.RowID)
                                        {
                                            <input type="radio" name="seleccion_sucursal" value="@sucursal.RowID" isdata.rowid="@sucursal.RowID" checked>
                                        }
                                        else
                                        {
                                            <input type="radio" name="seleccion_sucursal" isdata.rowid="@sucursal.RowID" value="@sucursal.RowID">
                                        }
                                    </td>
                                    <td>@sucursal.Nombre</td>
                                    <td>@sucursal.CentroOperacion</td>
                                    @if (sucursal.BloqueoCupo == true)
                                    {
                                        <td>Activo</td>
                                    }
                                    else
                                    {
                                        <td>Inactivo</td>
                                    }
                                    @if (sucursal.BloqueoMora == true)
                                    {
                                        <td>Activo</td>
                                    }
                                    else
                                    {
                                        <td>Inactivo</td>
                                    }
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="tab-pane" id="tab_3">
                <br/>
                <h4>Puntos de Envio</h4>
                <hr/>
                <table id="tbl_penvio" class="table table-condensed table-striped table-bordered table-hover table-checkable table-responsive">
                    <thead>
                        <tr>
                            <th class="lang" key="CODIGOSUCURSAL">Codigo Sucursal</th>
                            <th class="lang" key="CODIGOPUNTO">Codigo Punto</th>
                            <th class="lang" key="NOMBRE">Nombre</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var penvio in ((List<PedidosOnline.Models.PuntoEnvio>)ViewBag.ListadoPuntoEnv))
                        {
                            <tr>
                                <td>@penvio.Sucursal.RowID</td>
                                <td>@penvio.Codigo</td>
                                <td>@penvio.Nombre</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        <div class="tab-pane" id="tab_4">
            <!--CONTACTOS-->
            <div class="row">
                <div class="col-md-12">
                    <br />
                    <div style="margin-bottom: 20px;">
                        <h4 class="lang" key="CONTACTOS">Contactos</h4>
                        <hr />
                    </div>
                </div>
                <div class="col-md-12">
                    <div style="overflow-y:auto;height:200px">

                        <input type="hidden" id="rowid_contacto_principal" value="@Model.contacto_principal.RowID" />
                        <table id="tbl_contactos" class="table table-condensed table-striped table-bordered table-hover table-checkable table-responsive">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th class="lang" key="ID">ID</th>
                                    <th class="lang" key="NOMBRES">Nombres</th>
                                    <th class="lang" key="APELLIDOS">Apellidos</th>
                                    <th class="lang" key="CARGO">Cargo</th>
                                    <th class="lang" key="CORREO_ELECTRONICO">Correo Electrónico</th>
                                    <th class="lang" key="TELEFONO">Teléfonos</th>
                                    <th class="lang" key="CELULAR">Celular</th>
                                    <th class="lang" key="SUCURSAL">Sucursal</th>
                                </tr>
                            </thead>
                            <tbody>

                                @foreach (PedidosOnline.Models.Contacto contacto in ((List<PedidosOnline.Models.Contacto>)ViewBag.ListadoContactos))
                                {
                                    <tr>
                                        <td>
                                            @*@if (contacto.ind_principal == true)
                                                {*@
                                            @*<input type="radio" name="seleccion_contaco" value="@contacto.rowid" checked>*@
                                            @*}
                                                else
                                                {*@
                                            <input type="radio" name="seleccion_contaco" value="@contacto.RowID">
                                            @*}*@

                                        </td>
                                        <td>
                                            @contacto.Identificacion
                                        </td>
                                        <td style="width:160px">
                                            @contacto.Nombre
                                        </td>
                                        <td style="width:160px">
                                            @contacto.Apellido
                                        </td>
                                        <td>
                                            @contacto.Cargo
                                        </td>
                                        <td>
                                            <a mailto href="mailto:@contacto.Email">@contacto.Email</a>
                                        </td>
                                        <td>
                                            @contacto.Telefono1
                                        </td>
                                        <td>
                                            @contacto.Celular
                                        </td>
                                        <td>
                                            @*@contacto.erp_terceros_sucursale.nombre_sucursal*@
                                        </td>
                                    </tr>
                                }

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="tab-pane" id="tab_5">
            <br />
            <h4>Actividades</h4>
            <hr />
            <table id="tbl_actividades" class="table table-condensed table-striped table-bordered table-hover table-checkable table-responsive">
                <thead>
                    <tr>
                        <th class="lang" key="TIPO">Tipo</th>
                        <th class="lang" key="ASUNTO">Asunto</th>
                        <th class="lang" key="PRIORIDAD">Prioridad</th>
                        <th class="lang" key="TIPOREFERENCIA">Tipo Referencia</th>
                        <th class="lang" key="REFERENCIADOA">Referenciado a</th>
                        <th class="lang" key="DESCRIPCION">Descripci&oacute;n</th>
                        <th class="lang" key="INICIO">Inicio</th>
                        <th class="lang" key="FIN">Fin</th>
                        <th class="lang" key="ESTADO">Estado</th>
                        <th class="lang" key="USUARIO">Usuario</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var actividad in ((List<PedidosOnline.Models.Actividad>)ViewBag.ListaActividades))
                    {
                        <tr>
                            <td>@actividad.Opcion.Nombre</td>
                            <td>@actividad.Tema</td>
                            <td>@actividad.Opcion1.Nombre</td>
                            <td>@actividad.Opcion2.Nombre</td>
                            <td>@*@actividad.relacionado_a*@</td>
                            <td>@actividad.Descripcion</td>
                            <td>@actividad.FechaInicial</td>
                            <td>@actividad.FechaFinal</td>
                            <td>@actividad.EstadoID</td>
                            <td>@actividad.UsuarioCreacion</td>
                        </tr>
                    }
                </tbody>

            </table>
        </div>
    </div>
</div>

<!-- 會診 JQUERY -->
<script>


    var rowid_sucursal;
    var rowid_contacto;
    var IsData = {};
    var IsData2 = {};
    var hasChangue = false;//indica si se han realizado cambios en el formulario
    //evita que se dispare el mensaje de confirmacion de cierre de la pantalla al momento de enviar el servicio
    $(document).on("submit", "form", function(event){
        // deshabilita el mensaje
        $(window).off('beforeunload');
    });

    // Crea la alerta de salida de la pantalla cuando se han realizado cambios
    $(window).on('beforeunload', function(){
        if(hasChangue) return "Se perderán todos los cambios";
    });

    $(document).ready(function () {
        /*indica que en el formulario se modifico cualquier atributo*/
        $(':input').change(function() {
            hasChangue=true;
        });

        $("input[name=seleccion_contaco]").click(function () {
            $("#rowid_contacto_principal").val( $(this).val());
        });

        $("input[name=seleccion_sucursal]").click(function () {
            $("#rowid_sucursal_principal").val( $(this).val());
        });

        $("#tipo_industria").change(function(){
            $("#industria").val($("#tipo_industria option:selected").html());
        });


        $('#TableSucursal').dataTable({
            "processing": true,
            "bFilter": true,
            "bPaginate": true,
            "info": false,
            "bDestroy": true,
            aLengthMenu: [
                [3,5, 10, -1],
                [3,5, 10, "All"]
            ],
            "iDisplayLength": 3
        });

        $('#tbl_contactos').dataTable({
            "processing": true,
            "bFilter": true,
            "bPaginate": true,
            "info": false,
            "bDestroy": true,
            aLengthMenu: [
                [3,5, 10, -1],
                [3,5, 10, "All"]
            ],
            "iDisplayLength": 3
        });
        $('#tbl_penvio').dataTable({
            "processing": true,
            "bFilter": true,
            "bPaginate": true,
            "info": false,
            "bDestroy": true,
            aLengthMenu: [
                [3,5, 10, -1],
                [3,5, 10, "All"]
            ],
            "iDisplayLength": 3
        });
        $('#tbl_actividades').dataTable({
            "processing": true,
            "bFilter": true,
            "bPaginate": true,
            "info": false,
            "bDestroy": true,
            aLengthMenu: [
                [3,5, 10, -1],
                [3,5, 10, "All"]
            ],
            "iDisplayLength": 3
        });

        //===== Validation =====//
        $.extend($.validator.defaults, {
            invalidHandler: function (form, validator) {
                var errors = validator.numberOfInvalids();
                if (errors) {
                    var message = errors == 1
                    ? 'Completar Campo Vacio.'
                    : 'Completar ' + errors + ' Campos que se encuentran vacios.';
                    Mensajes(message, 'error', '');
                }
            },
            rules: {},
            messages: {}
        });

        $.validator.messages.required = 'Campo requerido';
        $.validator.messages.email = 'Email invalido';
    });

    function ContactoPrincipal(accion,rowid) {
        $.ajax({
            type: "POST",
            url: "/CRM/ActualizarContactoPrincipal",
            data: {
                rowid_tercero: '@Model.tercero.RowID',
                rowid_contacto:rowid
            },
            success: function (data) {

                if(data != 1){

                    $("#tbl_contactos").empty();

                    $("#tbl_contactos").append('<thead>' +
                                                    '<tr>' +
                                                        '<th > </th>' +
                                                        '<th class="lang" key="IDENTIFICACION">Identificacion</th>' +
                                                        '<th class="lang" key="NOMBRES">Nombres</th>' +
                                                        '<th class="lang" key="APELLIDOS">Apellidos</th>' +
                                                        '<th class="lang" key="CARGO">Cargo</th>' +
                                                        '<th class="lang" key="SUCURSAL">Sucursal</th>' +
                                                        '<th class="lang" key="CORREO">Correo</th>'+
                                                        '<th class="lang" key="TELEFONO">Teléfono</th>'+
                                                        '<th class="lang" key="CELULAR">Celular</th>'+
                                                    '</tr>' +
                                                    '</thead><tbody>');


                    data.forEach(function (item) {

                        var check = "";
                        if(item.ind_principal==true || item.ind_principal==1){
                            check='<input type="radio" name="seleccion_contaco" value="'+item.rowid+'"   checked>'
                            var nombre=item.nombres+" "+item.apellidos;
                            $("#contacto_nombre").val(nombre);
                            $("#contacto_telefono").val(item.telefono);
                            $("#contacto_telefono2").val(item.celular);

                        }
                        else{
                            check='<input type="radio" name="seleccion_contaco"  value="'+item.rowid+'"  >'
                        }

                        $("#tbl_contactos").append(  '<tr>' +
                                '<td>'+check+'</td>' +
                                '<td>' + item.identificacion + '</td>' +
                                '<td>' + item.nombres + '</td>' +
                                '<td>' + item.apellidos + '</td>' +
                                '<td>' + item.cargo + '</td>' +
                                '<td>' + item.nombre_sucursal + '</td>' +
                                '<td>' + item.email + '</td>' +
                                '<td>' + item.telefono + '</td>' +
                                '<td>' + item.celular + '</td>' +
                            '</tr>');

                    });

                    $("#tbl_contactos").append('</tbody>');

                    $('#tbl_contactos').dataTable({
                        "processing": true,
                        "bFilter": true,
                        "bPaginate": true,
                        "info": false,
                        "bDestroy": true,
                        //"order": [[ 0, "desc" ]],
                        aLengthMenu: [
                            [3,5, 10, -1],
                            [3,5, 10, "All"]
                        ],
                        "iDisplayLength": 3
                    });
                    $("#tbl_contactos").removeAttr("style");
                }
                Mensajes('Cambio contacto principal exitoso', 'success', '');

                if (accion == 2) {
                    location.href = '/CRM/ListadoTercerosSucursal?rih=@Request.Params["rih"]';
                }
                ModalProcesandoHiden();

            },
            error: function (result1) {
                hasChangue=true;
                ModalProcesandoHiden();
                Mensajes('Se presento problema al momento de actualizar contacto', 'error', '');
                //alert(result1.responseText);
            }
        });
    }

    function SucursalPrincipal(accion,rowid, cerrar_procces) {
        //cerrar_procces 0 no cerrar y 1 cerrar
        $.ajax({
            type: "POST",
            url: "/CRM/ActualizarSucursalPrincipal",
            data: {
                rowid_tercero: '@Model.tercero.RowID',
                rowid_sucursal:rowid
            },
            success: function (data) {

                if(data != 1){
                    $("#TableSucursal").empty();

                    $("#TableSucursal").append('<thead>' +
                                                    '<tr>' +
                                                        '<th > </th>' +
                                                        '<th class="lang" key="SUCURSAL">Sucursal</th>' +
                                                        '<th class="lang" key="DIRECCION">Direccion</th>' +
                                                        '<th class="lang" key="TELEFONO">Telefono</th>' +
                                                    '</tr>' +
                                                    '</thead><tbody>');
                    data.forEach(function (item) {

                        var check = "";
                        if (item.ind_principal) {
                            check = '<input type="radio" id="seleccion_sucursal"  name="seleccion_sucursal" value="' + item.rowid + '" IsData.rowid="'+item.rowid+'"  checked>'
                            $("#sucursal_principal").val(item.nombre_sucursal);
                            $("#sucursal_ciudad").val(item.ciudad);
                            $("#sucursal_departamento").val(item.departamento);
                            $("#sucursal_pais").val(item.pais);

                        }
                        else {
                            check = '<input type="radio" id="seleccion_sucursal"  name="seleccion_sucursal" value="' + item.rowid + '" IsData.rowid="'+item.rowid+'"  >'
                        }

                        $("#TableSucursal").append('<tr>' +
                                '<td>' + check + '</td>' +
                                '<td>' + item.nombre_sucursal + '</td>' +
                                '<td>' + item.direccion1 + '</td>' +
                                '<td>' + item.telefono1 + '</td>' +
                            '</tr>');
                    });
                    $("#TableSucursal").append('</tbody>');

                    $('#TableSucursal').dataTable({
                        "processing": true,
                        "bFilter": true,
                        "bPaginate": true,
                        "info": false,
                        "bDestroy": true,
                        aLengthMenu: [
                            [3,5, 10, -1],
                            [3,5, 10, "All"]
                        ],
                        "iDisplayLength": 3
                    });
                    $("#TableSucursal").removeAttr("style");
                }
                Mensajes('Cambio sucursal principal exitosa', 'success', '');

                $('input[id=seleccion_sucursal]:radio[value='+rowid+']').attr('checked',true)
                if(cerrar_procces==1){

                    if (accion == 2) {
                        location.href = '/CRM/ListadoTercerosSucursal?rih=@Request.Params["rih"]';
                    }
                    ModalProcesandoHiden();
                }
                else{
                    ContactoPrincipal(accion,$("#rowid_contacto_principal").val());
                }
                ModalProcesandoHiden();

            },
            error: function (result1) {
                hasChangue=true;
                ModalProcesandoHiden();
                Mensajes('Se presento problema al momento de actualizar la sucursal', 'error', '');
                //alert(result1.responseText);
            }
        });
    }
    function enviarformulario(accion) {
        //accion: 1=guardar, 2=guardar y cerrar

        var validator = $("#form").validate();


        if (validator.form()) {
            hasChangue=false;
            ModalProcesandoShow();

            $.ajax({
                type: "POST",
                url: "/CRM/Tercero_Actualizar",
                data: {
                    rowid_tercero:@Model.tercero.RowID,
                    industria: $("#industria").val(),
                    tipo_industria: $("#tipo_industria").val(),
                    clasificacion:$("#clasificacion").val()
                },
                success: function (data2) {

                    Mensajes("Datos tercero actualizados exitosamente", 'success', '');
                        ModalProcesandoHiden();
                        if (accion == 2) {
                            location.href = '/CRM/ListadoTercerosSucursal?rih=@Request.Params["rih"]';
                        }

                },
                error: function (request) {
                    hasChangue=true;
                    ruta = null;
                    ModalProcesandoHiden();
                    Mensajes(request.responseText, 'error', '');
                }
            });


        }
    }

    function ActualizarPrincipales(accion,cnt_actualizaciones){
        rowid_sucursal=$("#rowid_sucursal_principal").val();
        rowid_contacto=$("#rowid_contacto_principal").val();

        if(cnt_actualizaciones==1){
            if($("input[name=seleccion_sucursal]").val() !=undefined && $("input[name=seleccion_sucursal]").val()!="")
                SucursalPrincipal(accion,rowid_sucursal,1);
            if($("input[name=seleccion_contaco]").val()!=undefined && $("input[name=seleccion_contaco]").val()!="")
                ContactoPrincipal(accion,rowid_contacto);
        }
        else{
            SucursalPrincipal(accion,rowid_sucursal,0);
        }
    }
</script>
<!-- 圖像 JQUERY - HIGHCHART-->
<script type="text/javascript">
    //Grafica Ventas Mensuales
    $('#chart_mensual').highcharts({
        chart: {
            type: 'areaspline'
        },
        title: {
            text: 'Pedidos despachados: Últimos 30 Días'
        },
        colors: [
            '#f03c3d',
        ],
        legend: {
            layout: 'vertical',
            align: 'left',
            verticalAlign: 'top',
            x: 150,
            y: 100,
            floating: true,
            borderWidth: 1,
            backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF'
        },
        xAxis: {
            categories: [
            @foreach (PedidosOnline.Utilidades.DatoValorGrafica curReg in ViewBag.listaPedidos)
    {
        <Text>['</Text>@curReg.Dato<Text>'],  </Text>
    }
    ],
    plotBands: [{ // visualize the weekend
        from: 4.5,
        to: 6.5,
        color: 'rgba(225, 225, 225, .0)'
    }]
    },
    yAxis: {
            title: {
                text: 'Valores en pesos'
            }
    },
    tooltip: {
            shared: true,
            valueSuffix: ' '
    },
    credits: {
            enabled: false
    },
    plotOptions: {
            areaspline: {
                fillOpacity: 0.5
            }
    },
    series: [{
        name: '.',
        data: [
            @foreach (PedidosOnline.Utilidades.DatoValorGrafica curReg in ViewBag.listaPedidos)
            {
                <Text>['</Text>@curReg.Dato<Text>',</Text>@curReg.Valor<Text>],  </Text>
            }
    ]
    }]
    });
                    $('#chart_anual').highcharts({
                        chart: {
                            type: 'column'
                        },
                        title: {
                            text: 'Pedidos despachados: Últimos 12 Meses'
                        },
                        colors: [
                            '#f03c3d',
                        ],
                        xAxis: {
                            type: 'category',
                            labels: {
                                rotation: -45,
                                style: {
                                    fontSize: '13px',
                                    fontFamily: 'Verdana, sans-serif'
                                }
                            }
                        },
                        yAxis: {
                            title: {
                                text: 'Valores en pesos'
                            }
                        },
                        legend: {
                            enabled: false
                        },
                        series: [{
                            data: [
                                @foreach (PedidosOnline.Utilidades.DatoValorGrafica curReg in ViewBag.listaPedidosAnual)
                                {
                                    <Text>['</Text>@curReg.Dato<Text>',</Text>@curReg.Valor<Text>],  </Text>
                                }
                            ]
                        }]
                    });

            //Grafica Ventas Anuales Cartera
            Highcharts.getOptions().plotOptions.pie.colors = (function () {
            var colors = [],
            base = Highcharts.getOptions().colors[1],
            i;
            for (i = 0; i < 10; i += 1) {
                colors.push(Highcharts.Color(base).brighten((i - 1) / 7).get());
            }
        return colors;
        }());
        $('#chart_anual_cartera').highcharts({
            title: {
                text: 'Pedidos aprobados: últimos 12 Meses'
            },
            colors: [
                '#f03c3d',
            ],
            xAxis: {
                categories: [
                @foreach (PedidosOnline.Utilidades.DatoValorGrafica curReg in ViewBag.listaPedidosAnual)
                    {
                        <Text>['</Text>@curReg.Dato<Text>'],  </Text>
                    }
                ]
            },
            labels: {
                items: [{
                    html: 'Meses',
                    style: {
                        left: '0px',
                        top: '18px',
                        color: (Highcharts.theme && Highcharts.theme.textColor) || '#333'
                    }
                }]

            },
            yAxis: {
                title: {
                    text: 'Valores en pesos'
                }
            },
            series: [{
                type: 'column',
                name: 'Meses',
                data: [0]
            }, {
                type: 'spline',
                name: 'Promedio',
                data: [
                    @foreach (PedidosOnline.Utilidades.DatoValorGrafica curReg in ViewBag.listaPedidosAnual)
                    {
                        <Text>['</Text>@curReg.Dato<Text>',</Text>@curReg.Valor<Text>],  </Text>
                    }
                ],
                marker: {
                    lineWidth: 2,
                    lineColor: Highcharts.getOptions().colors[4],
                    fillColor: 'white'
                }
            },
            {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false,
                    type: 'pie',
                        data: [
                            @foreach (PedidosOnline.Utilidades.DatoValorGrafica curReg in ViewBag.listaPedidosAnual)
                            {
                                 <Text>['</Text>@curReg.Dato<Text>',</Text>@curReg.Valor<Text>], </Text>
                            }
                        ],
                        center: [50, 40],
                        size: 50,
                        showInLegend: false,
                        dataLabels: {
                        enabled: false
                        }, credits: {
                            enabled: false
                        },
            }]
        });
    function ejemplo() {
        $.ajax({
            type: "GET",
            url: "/Ventas/ejemplo",
            success: function (data) {//seleccion al autocompletar
            },
            error: function (request) {
            }
        });
    }
</script>